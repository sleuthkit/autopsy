language: java

jobs:
  include:
    - os: linux
      dist: bionic
    - os: osx
      osx_image: xcode12.2

env:
  global:
    - TSK_HOME=$TRAVIS_BUILD_DIR/sleuthkit/sleuthkit

addons:
  apt:
    update: true
    packages:
      - testdisk
      - libafflib-dev
      - libewf-dev
      - libpq-dev
      - autopoint
      - libsqlite3-dev
      - ant
      - ant-optional
      - libcppunit-dev
      - wget
  homebrew:
    update: true
    packages:
      - ant
      - wget
      - libpq
      - libewf
      - gettext
      - cppunit
      - afflib
      - testdisk

python:
  - 2.7

before_install:
  - git clone https://github.com/sleuthkit/sleuthkit.git sleuthkit/sleuthkit
  - python setupSleuthkitBranch.py

install:
  - pushd sleuthkit/sleuthkit && ./travis_install_libs.sh && popd

before_script:
  - if [ $TRAVIS_OS_NAME = linux ]; then 
        wget -q -O - https://download.bell-sw.com/pki/GPG-KEY-bellsoft | sudo apt-key add -;
        echo "deb [arch=amd64] https://apt.bell-sw.com/ stable main" | sudo tee /etc/apt/sources.list.d/bellsoft.list; 
        sudo apt-get update;
        sudo apt-get install bellsoft-java17-full;
        export PATH=/usr/bin:$PATH;
        export JAVA_HOME=/usr/lib/jvm/bellsoft-java17-full-amd64; 
    fi
  - if [ $TRAVIS_OS_NAME = osx ]; then 
        brew uninstall java --force --ignore-dependencies; 
        brew cask uninstall java --force; 
        brew tap bell-sw/liberica; 
        brew install --cask liberica-jdk17-full; 
        export JAVA_HOME=/Library/Java/JavaVirtualMachines/liberica-jdk-17-full.jdk/Contents/Home;
    fi
  - java -version

script: ./travis_build.sh